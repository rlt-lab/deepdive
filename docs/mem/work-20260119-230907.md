# Work Session Log - 2026-01-19

## Summary
Researched and designed a comprehensive door system for the roguelike game, including analysis of classic roguelikes (Nethack, Brogue, Caves of Qud) and created a detailed implementation plan.

## Accomplished
- Researched door mechanics in Nethack, Brogue, and Caves of Qud
- Queried Bevy documentation via context7 MCP for ECS patterns
- Explored codebase to understand existing tile, FOV, persistence, and input systems
- Created comprehensive design document at `docs/door_system_design.md` including:
  - Research summary with references
  - Codebase analysis
  - Phased implementation plan (MVP → Enhanced → Advanced)
  - Code examples for all major systems
  - Potential issues at scale and mitigations
  - Testing strategy and implementation checklist
- Updated input handling design per user request:
  - Move into closed door → opens and moves player onto tile
  - O key → explicitly opens adjacent door
  - C key → explicitly closes adjacent door

## Key Decisions
- Doors use a `Door` component with `is_open: bool` state, separate from `TileType::Door`
- Door sprites: closed (2,16)=274, open (3,16)=275 from tiles.png
- Door placement algorithm finds corridor tiles (floor with walls on opposite sides)
- Persistence via `door_states: HashMap<(u32, u32), bool>` in `SavedMapData`
- Closed doors block FOV (like walls), open doors allow vision through

## Next Steps
- Implement MVP door system following the checklist in the design doc
- Add Door component and TileType::Door variant
- Modify movement system to handle door opening
- Add O/C key bindings for explicit door control
- Update FOV system to check door states
- Implement door placement in map generation
